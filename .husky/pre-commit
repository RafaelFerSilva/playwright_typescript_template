echo "ğŸš€ Executando pre-commit hooks..."

# 1. Rodar lint-staged (ESLint + Prettier nos arquivos staged)
echo "ğŸ“ Executando lint e formataÃ§Ã£o nos arquivos staged..."
npx lint-staged

# Verificar se lint-staged passou
if [ $? -ne 0 ]; then
  echo "âŒ Lint/formataÃ§Ã£o falhou. Corrija os erros antes de commitar."
  exit 1
fi

# 2. Compilar TypeScript (usando seu script pretest)
echo "ğŸ”§ Compilando TypeScript..."
npm run pretest

# Verificar se compilaÃ§Ã£o passou
if [ $? -ne 0 ]; then
  echo "âŒ CompilaÃ§Ã£o TypeScript falhou. Corrija os erros de tipo antes de commitar."
  exit 1
fi

# 3. Rodar testes do Playwright (modo CI/headless)
echo "ğŸ­ Executando testes do Playwright..."
npm run test:ci

# Verificar se testes passaram
if [ $? -ne 0 ]; then
  echo "âŒ Testes do Playwright falharam. Corrija os testes antes de commitar."
  exit 1
fi

echo "âœ… Todos os checks passaram! Commit liberado."
